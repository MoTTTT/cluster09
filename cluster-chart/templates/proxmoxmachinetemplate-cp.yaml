---
apiVersion: infrastructure.cluster.x-k8s.io/v1alpha1
kind: ProxmoxMachineTemplate
metadata:
  name: "{{ .Values.cluster.name }}-controlplane"
  namespace: "{{ .Values.cluster.name }}"
  labels:
    {{- include "cluster-chart.labels" . | nindent 4 }}
spec:
  template:
    spec:
      sourceNode: {{ .Values.proxmox.template.sourcenode }}
      templateID: {{ .Values.proxmox.template.template_vmid }}
      disks:
        bootVolume:
          disk: {{ .Values.proxmox.vm.boot_volume_device }}
          sizeGb: {{ .Values.controlplane.boot_volume_size }}
      format: qcow2
      full: true
      memoryMiB: {{ .Values.controlplane.memory_mib }}
      network:
        default:
          bridge: {{ .Values.proxmox.vm.bridge }}
          model: virtio
      numCores: {{ .Values.controlplane.num_cores }}
      numSockets: {{ .Values.controlplane.num_sockets }}
      checks:
        skipCloudInitStatus: true
        skipQemuGuestAgent: true
      metadataSettings:
        providerIDInjection: true
