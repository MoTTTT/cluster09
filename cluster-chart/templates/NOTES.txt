Cluster API Cluster Provisioning helm chart: cluster-chart

Thank you for installing {{ .Chart.Name }}. Your release is named {{ .Release.Name }}. Cluster API resources have been created in the {{ .Values.cluster.name }} namespace.

To viw progress with the Cluster API provisioning:
  $ clusterctl describe cluster {{ .Values.cluster.name }} -n {{ .Values.cluster.name }} --show-conditions all --show-templates --show-resourcesets --grouping=false --echo

To extract a talos configuration file for the the target cluster: 
  $ kubectl get secret --namespace {{ .Values.cluster.name }} {{ .Values.cluster.name }}-talosconfig -o jsonpath='{.data.talosconfig}' | base64 -d > {{ .Values.cluster.name }}-talosconfig

To extract kubectl config file for the the target cluster.
  $ kubectl get secret --namespace {{ .Values.cluster.name }} {{ .Values.cluster.name }}-kubeconfig -o jsonpath='{.data.value}' | base64 -d > {{ .Values.cluster.name }}-kubeconfig
This step is optional, but will be required where the access configuration needs to be provided to a cluster owner, or where a bastion server is used.
If you are going to be accessing the kubernetes API for the target cluster via a bastion server, it will be necessary to adjust the generated endpoint in the {{ .Values.cluster.name }}-kubeconfig file accordingly.

Configure kubectl (i.e. your ~/.kube/config file) to include the context and credentials for the new cluster:
  $ talosctl kubeconfig --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig
This will set the kubectl context of the target cluster active.

To view the Talos dashboard for the target cluster:
  $ talosctl dashboard --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig

Talos logs retrieval (the following examples are applied to the control plane node currently serving the k8s API VIP. The --nodes IP address should be altered to interrogate any other node):
  $ talosctl dmesg --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig
List services:
  $ talosctl services --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig
Logs for a service (e.g.machined):
  $ talosctl logs machined --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig
List containers:
  $ talosctl containers -k --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig
Logs for a container (e.g. kube-system/cilium-envoy-zjv5m:cilium-envoy:66f785c68929):
  $ talosctl logs -k kube-system/cilium-envoy-zjv5m:cilium-envoy:66f785c68929 --nodes {{ .Values.controlplane.endpoint_ip }} --endpoints {{ .Values.controlplane.endpoint_ip }} --talosconfig=./{{ .Values.cluster.name }}-talosconfig

Kubectl and k9s can be used to watch the cluster pods provisioning, and view logs. Depending on your cluster configuration this may take a while.

Once your cluster stabilises, and the pods are all running, bootstrap your cluster to a gitops repo. 

Add a secret to your cluster with the following (using the kubectl context of of the {{ .Values.cluster.name }} cluster):
  $   

The flux operator will pick up the secret and sync your cluster to your gitops repository.

If you have not loaded a FluxInstance with extraManifests from you gitops cluster, as in the default values.yaml example, you can configure and apply one now:

---
apiVersion: fluxcd.controlplane.io/v1
kind: FluxInstance
metadata:
  name: flux
  namespace: flux-system
spec:
  distribution:
    version: "2.7.x"
    registry: "ghcr.io/fluxcd"
  sync:
    kind: GitRepository
    url: "https://github.com/<username>/<Git repository name>.git"
    ref: "refs/heads/main"
    path: "clusters/{{ .Values.cluster.name }}"
    pullSecret: "flux-system"
---



